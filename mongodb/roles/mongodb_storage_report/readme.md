# –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞

## –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
`os_disk_usage_analysis.sh` ‚Äî –±—ã—Å—Ç—Ä—ã–π –∞–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∏—Å–∫–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –û–°:
- filesystem summary (df)
- top directories by size (du)
- top files by size (find)
- deleted-but-open files (lsof)
- per-user usage
- file extension breakdown
- directories with many files

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞: Linux (Ubuntu/Debian), GNU coreutils.
- –£—Ç–∏–ª–∏—Ç—ã: df, du, find, sort, head, awk. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: numfmt, lsof.
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–ø—É—Å–∫–∞—Ç—å –æ—Ç root (sudo), –∏–Ω–∞—á–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç —á–∞—Å—Ç–∏—á–Ω—ã–º–∏.

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
- `-n, --top N` ‚Äî —Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ "top" —Å–ø–∏—Å–∫–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 20).
- `-d, --dir PATH` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ).
- `-o, --output FILE` ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç—á—ë—Ç –≤ —Ñ–∞–π–ª.
- `-q, --quiet` ‚Äî —Ç–∏—Ö–∏–π —Ä–µ–∂–∏–º (—Å–æ–∫—Ä–∞—â–∞–µ—Ç —Å–ª—É–∂–µ–±–Ω—ã–π –≤—ã–≤–æ–¥).
- `-h, --help` ‚Äî –ø–æ–º–æ—â—å.

## –ü—Ä–∏–º–µ—Ä—ã
```bash
sudo scripts/os_disk_usage_analysis.sh
sudo scripts/os_disk_usage_analysis.sh -n 50 -d /var/lib/mongodb -o /tmp/report.txt
# Role: mongo_analysis

## üìã –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–†–æ–ª—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∏—Å–∫–∞:
- **–Ω–∞ —É—Ä–æ–≤–Ω–µ MongoDB** ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∏ –∏–Ω–¥–µ–∫—Å—ã –∑–∞–Ω–∏–º–∞—é—Ç –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –º–µ—Å—Ç–∞;
- **–Ω–∞ —É—Ä–æ–≤–Ω–µ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã** ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –∏ –∫–∞—Ç–∞–ª–æ–≥–æ–≤ —Å –¥–∞–Ω–Ω—ã–º–∏ MongoDB.

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ Ansible **—Ç–æ—á–Ω–æ –≤ —Ç–æ–º –∂–µ –≤–∏–¥–µ**, –∫–∞–∫ –ø—Ä–∏ —Ä—É—á–Ω–æ–º –∑–∞–ø—É—Å–∫–µ.

---

## ‚öôÔ∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–æ–ª–∏

–†–æ–ª—å –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –Ω–∞ –ª—é–±–æ–º —É–∑–ª–µ MongoDB-–∫–ª–∞—Å—Ç–µ—Ä–∞.  
–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è MongoDB, –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º–æ–≥–æ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –∑–∞–ø—É—Å–∫–∞.

---

## –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—É—Å–∫–∞ —Ä–æ–ª–∏

### –∑–∞–ø—É—Å–∫ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç—á—ë—Ç–∞ –æ –¥–∏—Å–∫–æ–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ MongoDB –∏ –û–°

ansible-playbook -i ~/git_repos/infrastructure/mongodb mongo_analysis.yml --limit some_host_from_replicaset --extra-vars "mongo_user=db_admin_username mongo_password=***"

  ### –∑–∞–ø—É—Å–∫ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç—á—ë—Ç–∞ –æ –¥–∏—Å–∫–æ–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ MongoDB –∏ –û–° –¥–ª—è –∫–∞—Ç–∞–ª–æ–≥–∞ /var/lib/mongodb

ansible-playbook -i ~/git_repos/infrastructure/mongodb mongo_analysis.yml --limit some_host_from_replicaset --extra-vars "mongo_user=admin mongo_password=*** mongo_analysis_target_dir=/var/lib/mongodb"

  ### –∑–∞–ø—É—Å–∫ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç—á—ë—Ç–∞ –æ –¥–∏—Å–∫–æ–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ MongoDB –∏ –û–° —Ç–æ–ø 10 –æ–±—å–µ–∫—Ç–æ–≤, –ø–æ—Ä–æ–≥ —Ä–∞–∑–º–µ—Ä–∞ - 100 –ú–ë

ansible-playbook -i ~/git_repos/infrastructure/mongodb mongo_analysis.yml --limit some_host_from_replicaset --extra-vars "mongo_user=db_admin_username mongo_password=*** mongo_top_n=10 mongo_min_mb=100"
