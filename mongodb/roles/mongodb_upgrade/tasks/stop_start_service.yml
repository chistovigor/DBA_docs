---
- name: Получаем информацию о сервисах
  ansible.builtin.service_facts:

- name: Остановить MongoDB перед обновлением
  ansible.builtin.systemd:
    name: "{{ mongodb_service_name }}"
    state: stopped
    daemon_reload: true
  when:
    - service_action == "stop"
    - "'{{ mongodb_service_name }}.service' in ansible_facts.services"

- name: Запустить MongoDB после обновления
  ansible.builtin.systemd:
    name: "{{ mongodb_service_name }}"
    state: started
    enabled: true
    daemon_reload: true
  when:
    - service_action == "start"
    - "'{{ mongodb_service_name }}.service' in ansible_facts.services"
